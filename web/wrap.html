<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>git</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="stylesheet" type="text/css" href="dagre.css" />
    <link rel="stylesheet" type="text/css" href="jquery.terminal.css" />
  </head>
  <body>

    <div class="emscripten" id="status">Downloading...</div>
    <div class="emscripten">
      <progress value="0" max="100" id="progress" hidden=1></progress>  
    </div>

    <div style="width:40%; float:left; margin:10px;">
    <svg height="800px" width="100%" style="border:none;">
      <defs>
        <marker id="arrowhead"
                viewBox="0 0 10 10"
                refX="8"
                refY="5"
                markerUnits="strokeWidth"
                markerWidth="8"
                markerHeight="5"
                orient="auto"
                style="fill: #333">
        </marker>
      </defs>
    </svg>
    </div>

    <div style="overflow:hidden;">
        <div id="directory_listing"></div>
        <textarea id="text_editor" rows=10></textarea>
    </div>
    <span id="save">save</span>
    <br /><br />
    <div id="term_demo"></div>

    <!--<a href="https://github.com/zodiac/libgit2.js"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>-->

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-36868476-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

    <script src="jquery.min.js"></script>

    <script src="libgit-pre.js"></script>
    <script>
    var decompressWorker = new Worker('decompress.js');
    var decompressCallbacks = [];
    var decompressions = 0;
    Module["decompress"] = function(data, callback) {
      var id = decompressCallbacks.length;
      decompressCallbacks.push(callback);
      decompressWorker.postMessage({ data: data, id: id });
      if (Module['setStatus']) {
        decompressions++;
        Module['setStatus']('Decompressing... (chrome users: lzma decompression uses lots of memory, killing the tab. closed other processes that use too much memory)');
      }
    };
    decompressWorker.onmessage = function(event) {
      decompressCallbacks[event.data.id](event.data.data);
      decompressCallbacks[event.data.id] = null;
      if (Module['setStatus']) {
        decompressions--;
        if (decompressions == 0) {
          Module['setStatus']('');
          FS.checkStreams = function() {return;};//TODO: file bug report against too many FS.streams
        }
      }
    };
    var compiledCodeXHR = new XMLHttpRequest();
    compiledCodeXHR.open('GET', 'libgit.js.compress', true);
    compiledCodeXHR.responseType = 'arraybuffer';
    compiledCodeXHR.onload = function() {
      var arrayBuffer = compiledCodeXHR.response;
      if (!arrayBuffer) throw('Loading compressed code failed.');
      var byteArray = new Uint8Array(arrayBuffer);
      Module.decompress(byteArray, function(decompressed) {
        var source = Array.prototype.slice.apply(decompressed).map(function(x) { return String.fromCharCode(x) }).join(''); // createObjectURL instead?
        var scriptTag = document.createElement('script');
        scriptTag.setAttribute('type', 'text/javascript');
        scriptTag.innerHTML = source;
        document.body.appendChild(scriptTag);
      });
    };
    compiledCodeXHR.send(null);
    </script>

    <script src="timeline.js"></script>
    <script src="functions.js"></script>

    <script src="d3.v2.min.js"></script>
    <script src="dagre.js"></script>
    <script src="graphing.js"></script>

    <script src="git-terminal.js"></script>
    <script src="jquery.terminal-0.6.3.min.js"></script>
    <script>
    $('#term_demo').terminal(function(command, term) {
        if (command !== '') {
            try {
                var result = git_eval(command);
                if (result !== undefined) {
                    term.echo(new String(result));
                }
            } catch(e) {
                term.error(new String(e));
                throw e;
            }
        } else {
           term.echo('');
        }
    }, {
        greetings: 'libgit2.js - type help for a list of commands',
        name: 'js_demo',
        height: 200,
        prompt: '> '});
    </script>

  </body>
</html>
